var game={dataArr:[],score:0,rn:4,cn:4,numberCon:document.getElementById("number-container"),init:function(){var t=document.getElementById("gameover");t.style.display="none",this.score=0;var r=document.getElementById("score");r.inenrHTML=0,this.dataArr=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.productOneNumber(),this.productOneNumber(),this.updateView(),window.document.onkeydown=function(t){switch(t=t||window.event,t.preventDefault(),t.keyCode){case 37:game.moveLeft();break;case 39:game.moveRight();break;case 40:game.moveDown();break;case 38:game.moveUp()}}},productOneNumber:function(){if(!this.isFull()){for(;;){var t=Math.floor(Math.random()*this.rn),r=Math.floor(Math.random()*this.cn);if(0==this.dataArr[t][r])break}this.dataArr[t][r]=Math.random()>.5?4:2}},isFull:function(){for(var t=0;t<this.rn;t++)for(var r=0;r<this.cn;r++)if(0==this.dataArr[t][r])return!1;return!0},isGameOver:function(){if(!this.isFull())return!1;if(this.isFull)for(var t=0;t<this.rn;t++)for(var r=0;r<this.cn;r++){if(r!=this.cn-1&&this.dataArr[t][r]===this.dataArr[t][r+1])return!1;if(t!=this.rn-1&&this.dataArr[t][r]==this.dataArr[t+1][r])return!1}return!0},updateView:function(){for(var t=0;t<this.rn;t++)for(var r=0;r<this.cn;r++){var e=this.dataArr[t][r],n=document.getElementById("number-cell-"+t+"-"+r);0!=e?(n.innerHTML=e,n.style.backgroundColor=this.getBgcolor(e),n.style.color=this.getNumberColor(e),e>1e4&&(n.style.fontSize="35px")):(n.innerHTML="",n.style.backgroundColor="transparent")}var a=document.getElementById("score");if(a.innerHTML=this.score,this.isGameOver()){var i=document.getElementById("gameover"),o=document.getElementById("endScore");o.innerHTML=this.score,i.style.display="block",document.onkeydown=function(t){13==t.keyCode&&game.newGame()}}},getNumberColor:function(t){return t<=4?"#776e65":"#fff"},getBgcolor:function(t){switch(t){case 2:return"#eee4da";case 4:return"#eee4da";case 8:return"#f26179";case 16:return"#f59563";case 32:return"#f67c5f";case 64:return"#f65e36";case 128:return"#edcf72";case 256:return"#edcc61";case 512:return"#9c0";case 1024:return"#3365a5";case 2048:return"#09c";case 4096:return"#a6bc";case 8192:return"#93c"}return"black"},getNextRight:function(t,r){for(var e=r+1;e<this.cn;e++)if(0!=this.dataArr[t][e])return e;return-1},moveInRow:function(t,r,e,n){return 0==this.dataArr[t][r]?(this.dataArr[t][r]=this.dataArr[t][e],this.dataArr[t][e]=0,"left"==n?-1:1):void(this.dataArr[t][r]==this.dataArr[t][e]&&(this.dataArr[t][r]*=2,this.dataArr[t][e]=0,this.score+=this.dataArr[t][r]))},moveLeftInRow:function(t){for(var r=0;r<this.cn-1;r++){var e=this.getNextRight(t,r);if(e==-1)break;var n=this.moveInRow(t,r,e,"left");n==-1&&r--}},moveLeft:function(){for(var t=this.dataArr.toString(),r=0;r<this.rn;r++)this.moveLeftInRow(r);var e=this.dataArr.toString();t!=e&&(this.productOneNumber(),this.updateView())},getLeftNext:function(t,r){for(var e=r-1;e>=0;e--)if(0!=this.dataArr[t][e])return e;return-1},moveRightInRow:function(t){for(var r=this.cn-1;r>0;r--){var e=this.getLeftNext(t,r);if(e==-1)break;var n=this.moveInRow(t,r,e,"right");1==n&&r++}},moveRight:function(){for(var t=this.dataArr.toString(),r=0;r<this.rn;r++)this.moveRightInRow(r);var e=this.dataArr.toString();t!=e&&(this.productOneNumber(),this.updateView())},getNextUp:function(t,r){for(var e=t-1;e>=0;e--)if(0!=this.dataArr[e][r])return e;return-1},moveInCol:function(t,r,e,n){return 0==this.dataArr[t][r]?(this.dataArr[t][r]=this.dataArr[e][r],this.dataArr[e][r]=0,"down"==n?-1:1):void(this.dataArr[t][r]==this.dataArr[e][r]&&(this.dataArr[t][r]*=2,this.dataArr[e][r]=0,this.score+=this.dataArr[t][r]))},moveDownInCol:function(t){for(var r=this.rn-1;r>0;r--){var e=this.getNextUp(r,t);if(e==-1)break;var n=this.moveInCol(r,t,e,"down");n==-1&&r--}},moveDown:function(){for(var t=this.dataArr.toString(),r=0;r<this.cn;r++)this.moveDownInCol(r);var e=this.dataArr.toString();e!=t&&(this.productOneNumber(),this.updateView())},getNextDown:function(t,r){for(var e=t+1;e<this.rn;e++)if(0!=this.dataArr[e][r])return e;return-1},moveUpInCol:function(t){for(var r=0;r<this.rn;r++){var e=this.getNextDown(r,t);if(e==-1)break;var n=this.moveInCol(r,t,e,"down");1==n&&r++}},moveUp:function(){for(var t=this.dataArr.toString(),r=0;r<this.cn;r++)this.moveUpInCol(r);var e=this.dataArr.toString();e!=t&&(this.productOneNumber(),this.updateView())},newGame:function(){this.init()}};window.onload=function(){game.newGame()};